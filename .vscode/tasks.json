{
	"version": "2.0.0",
	"tasks": [
		{
			"label": "DB: up (local)",
			"type": "shell",
			"command": "docker compose -f docker-compose.yml up -d db",
			"problemMatcher": []
		},
		{
			"label": "DB: down (local)",
			"type": "shell",
			"command": "docker compose -f docker-compose.yml down",
			"problemMatcher": []
		},
		{
			"label": "Backend: go run :8081",
			"type": "shell",
			"command": "go run ./cmd/server",
			"options": {
				"cwd": "${workspaceFolder}/backend",
				"env": {
					"PORT": "8081",
					"AURA_FRONTEND_BASE_URL": "http://localhost:5173",
					"AURA_API_BASE_URL": "http://localhost:8081",
					"SMTP_HOST": "",
					"SMTP_PORT": "",
					"SMTP_USER": "",
					"SMTP_PASS": "",
					"SMTP_FROM": ""
				}
			},
			"isBackground": true,
			"problemMatcher": []
		},
		{
			"label": "Frontend: npm run dev",
			"type": "shell",
			"command": "npm run dev",
			"options": {
				"cwd": "${workspaceFolder}/frontend"
			},
			"isBackground": true,
			"problemMatcher": []
		},
		{
			"label": "Dev: Start All (local)",
			"dependsOn": [
				"DB: up (local)",
				"Backend: go run :8081",
				"Frontend: npm run dev"
			],
			"dependsOrder": "parallel"
		},
		{
			"label": "Dev: Compose up (dev)",
			"type": "shell",
			"command": "docker compose -f docker-compose.dev.yml up --build",
			"problemMatcher": []
		},
		{
			"label": "Dev: Compose down (dev)",
			"type": "shell",
			"command": "docker compose -f docker-compose.dev.yml down -v",
			"problemMatcher": []
		},
		{
			"label": "Backend: smoke test",
			"type": "shell",
			"command": "powershell -NoProfile -ExecutionPolicy Bypass -File ${workspaceFolder}/scripts/backend-smoke.ps1",
			"problemMatcher": []
		},
		{
			"label": "Backend: smoke test",
			"type": "shell",
			"command": "powershell -NoProfile -ExecutionPolicy Bypass -File ${workspaceFolder}/scripts/backend-smoke.ps1"
		},
		{
			"label": "Backend: go run :8081 (signing)",
			"type": "shell",
			"command": "go run ./cmd/server",
			"args": [],
			"options": {
				"cwd": "${workspaceFolder}/backend",
				"env": {
					"PORT": "8081",
					"AURA_FRONTEND_BASE_URL": "http://localhost:5173",
					"AURA_API_BASE_URL": "http://localhost:8081",
					"AURA_DOWNLOAD_SIGNING_KEY": "dev_signing_key_123"
				}
			},
			"isBackground": true,
			"problemMatcher": [],
			"group": "build"
		},
		{
			"label": "Backend: run unit tests api jwks",
			"type": "shell",
			"command": "go test ./internal/api -run ^Test(OrgJWKS|VerifyEdDSA)_ -v",
			"args": [],
			"isBackground": false,
			"problemMatcher": [],
			"group": "build"
		}
	]
}